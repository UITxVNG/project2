[gd_scene load_steps=4 format=3 uid="uid://bqo1b46hrr23f"]

[ext_resource type="Texture2D" uid="uid://bn23ps3jhu4ru" path="res://assets/sprites/island/objects/platforms/moving_platform.png" id="1_anyem"]

[sub_resource type="GDScript" id="GDScript_anyem"]
script/source = "extends StaticBody2D

@onready var sprite: Sprite2D = $Sprite2D
@onready var collider: CollisionShape2D = $CollisionShape2D
@onready var timer: Timer = $Timer

@export var visible_duration: float = 2.0
@export var invisible_duration: float = 3.0

var is_visible: bool = true

func _ready() -> void:
	sprite.modulate.a = 1.0
	collider.disabled = false

	timer.wait_time = visible_duration
	timer.timeout.connect(_on_timer_timeout)
	timer.start()
	
func _on_timer_timeout() -> void:
	if is_visible:
		var warn_tween := get_tree().create_tween()
		warn_tween.tween_property(sprite, \"modulate:a\", 0.5, 0.2)
		warn_tween.tween_property(sprite, \"modulate:a\", 1.0, 0.2)
		warn_tween.set_loops(2) # nhấp nháy 2 lần
		
		await get_tree().create_timer(0.8).timeout
		
		var tween := get_tree().create_tween()
		tween.tween_property(sprite, \"modulate:a\", 0.2, 0.5)
		collider.disabled = true
		is_visible = false
		timer.wait_time = invisible_duration
	else:
		var tween := get_tree().create_tween()
		tween.tween_property(sprite, \"modulate:a\", 1.0, 0.5)
		collider.disabled = false
		is_visible = true
		timer.wait_time = visible_duration
	timer.start()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wd38v"]
size = Vector2(84, 14)

[node name="ChangeStatePlatform" type="StaticBody2D"]
script = SubResource("GDScript_anyem")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("1_anyem")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_wd38v")

[node name="Timer" type="Timer" parent="."]
